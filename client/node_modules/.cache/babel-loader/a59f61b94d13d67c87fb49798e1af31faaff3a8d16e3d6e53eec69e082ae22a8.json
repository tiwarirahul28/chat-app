{"ast":null,"code":"import * as e from \"react\";\nclass t extends e.Component {\n  constructor(t) {\n    super(t), this.wrapperRef = void 0, this.bottomRef = void 0, this.bottomRef = /*#__PURE__*/e.createRef(), this.wrapperRef = /*#__PURE__*/e.createRef(), this.handleScroll = this.handleScroll.bind(this), console.log(\"Component cstr\");\n  }\n  getSnapshotBeforeUpdate() {\n    if (console.log(\"Component \", this.getSnapshotBeforeUpdate.name), this.wrapperRef.current && this.bottomRef.current) {\n      const {\n        viewableDetectionEpsilon: e\n      } = this.props;\n      return t.isViewable(this.wrapperRef.current, this.bottomRef.current, e);\n    }\n    return !1;\n  }\n  componentDidUpdate(e, t, o) {\n    console.log(\"Component \", this.componentDidUpdate.name);\n    const {\n      forceScroll: r,\n      changeDetectionFilter: n\n    } = this.props;\n    n(e, this.props) && (r || o) && this.bottomRef.current && this.wrapperRef.current && this.scrollParentToChild(this.wrapperRef.current, this.bottomRef.current);\n  }\n  componentDidMount() {\n    console.log(\"Component \", this.componentDidMount.name), this.bottomRef.current && this.wrapperRef.current && this.scrollParentToChild(this.wrapperRef.current, this.bottomRef.current);\n  }\n  scrollParentToChild(e, o) {\n    const {\n      viewableDetectionEpsilon: r\n    } = this.props;\n    if (!t.isViewable(e, o, r)) {\n      const t = e.getBoundingClientRect(),\n        r = o.getBoundingClientRect().top + e.scrollTop - t.top,\n        {\n          animateScroll: n,\n          onScrollComplete: i\n        } = this.props;\n      n && (n(e, r), i());\n    }\n  }\n  static isViewable(e, t, o) {\n    o = o || 0;\n    const r = e.getBoundingClientRect(),\n      n = t.getBoundingClientRect();\n    return n.top >= r.top && r.top + e.clientHeight - n.top + o >= 0;\n  }\n  handleScroll() {\n    const {\n      viewableDetectionEpsilon: e,\n      onScroll: o\n    } = this.props;\n    o && this.bottomRef.current && this.wrapperRef.current && o(t.isViewable(this.wrapperRef.current, this.bottomRef.current, e));\n  }\n  scrollToBottom() {\n    this.bottomRef.current && this.wrapperRef.current && this.scrollParentToChild(this.wrapperRef.current, this.bottomRef.current);\n  }\n  render() {\n    console.log(\"Component \", this.render.name);\n    const {\n      children: t,\n      className: o\n    } = this.props; /*#__PURE__*/\n    return e.createElement(\"div\", {\n      className: o,\n      style: {\n        maxHeight: \"inherit\",\n        height: \"inherit\",\n        overflowY: \"auto\"\n      },\n      ref: this.wrapperRef,\n      onScroll: this.handleScroll\n    }, t, /*#__PURE__*/e.createElement(\"div\", {\n      ref: this.bottomRef\n    }));\n  }\n}\nt.defaultProps = {\n  forceScroll: !1,\n  animateScroll: (e, t) => {\n    e.scrollBy ? e.scrollBy({\n      top: t\n    }) : e.scrollTop = t;\n  },\n  onScrollComplete: () => {},\n  changeDetectionFilter: () => !0,\n  viewableDetectionEpsilon: 2,\n  onScroll: () => {}\n};\nexport { t as default };","map":{"version":3,"names":["t","e","Component","constructor","wrapperRef","bottomRef","createRef","handleScroll","bind","console","log","getSnapshotBeforeUpdate","name","current","viewableDetectionEpsilon","props","isViewable","componentDidUpdate","o","forceScroll","r","changeDetectionFilter","n","scrollParentToChild","componentDidMount","getBoundingClientRect","top","scrollTop","animateScroll","onScrollComplete","i","clientHeight","onScroll","scrollToBottom","render","children","className","createElement","style","maxHeight","height","overflowY","ref","defaultProps","scrollBy","default"],"sources":["/Users/rahultiwari/GitHub/webchat/chat-app/node_modules/react-scrollable-feed/src/index.tsx"],"sourcesContent":["import * as React from 'react';\nimport { CSSProperties } from 'react';\n\nexport type ScrollableFeedProps = {\n    forceScroll?: boolean;\n    animateScroll?: (element: HTMLElement, offset: number) => void;\n    onScrollComplete?: () => void;\n    changeDetectionFilter?: (previousProps: ScrollableFeedComponentProps, newProps: ScrollableFeedComponentProps) => boolean;\n    viewableDetectionEpsilon?: number;\n    className?: string;\n    onScroll?: (isAtBottom: boolean) => void;\n}\n\ntype ScrollableFeedComponentProps = React.PropsWithChildren<ScrollableFeedProps>;\n\nclass ScrollableFeed extends React.Component<React.PropsWithChildren<ScrollableFeedProps>> {\n    private readonly wrapperRef: React.RefObject<HTMLDivElement>;\n    private readonly bottomRef: React.RefObject<HTMLDivElement>;\n\n    constructor(props: ScrollableFeedProps) {\n        super(props);\n        this.bottomRef = React.createRef();\n        this.wrapperRef = React.createRef();\n        this.handleScroll = this.handleScroll.bind(this);\n\n        console.log(\"Component cstr\");\n    }\n\n    static defaultProps: ScrollableFeedProps = {\n        forceScroll: false,\n        animateScroll: (element: HTMLElement, offset: number): void => {\n            if (element.scrollBy) {\n                element.scrollBy({ top: offset });\n            }\n            else {\n                element.scrollTop = offset;\n            }\n        },\n        onScrollComplete: () => {},\n        changeDetectionFilter: () => true,\n        viewableDetectionEpsilon: 2,\n        onScroll: () => {},\n    };\n\n    getSnapshotBeforeUpdate(): boolean {\n      console.log(\"Component \", this.getSnapshotBeforeUpdate.name);\n        if (this.wrapperRef.current && this.bottomRef.current) {\n            const { viewableDetectionEpsilon } = this.props;\n            return ScrollableFeed.isViewable(this.wrapperRef.current, this.bottomRef.current, viewableDetectionEpsilon!); //This argument is passed down to componentDidUpdate as 3rd parameter\n        }\n        return false;\n    }\n\n    componentDidUpdate(previousProps: ScrollableFeedComponentProps, _previousState: any, snapshot: boolean): void {\n      console.log(\"Component \", this.componentDidUpdate.name);\n        const { forceScroll, changeDetectionFilter } = this.props;\n        const isValidChange = changeDetectionFilter!(previousProps, this.props);\n        if (isValidChange && (forceScroll || snapshot) && this.bottomRef.current && this.wrapperRef.current) {\n            this.scrollParentToChild(this.wrapperRef.current, this.bottomRef.current);\n        }\n    }\n\n    componentDidMount(): void {\n      console.log(\"Component \", this.componentDidMount.name);\n        //Scroll to bottom from the start\n        if (this.bottomRef.current && this.wrapperRef.current) {\n            this.scrollParentToChild(this.wrapperRef.current, this.bottomRef.current);\n        }\n    }\n\n    /**\n     * Scrolls a parent element such that the child element will be in view\n     * @param parent\n     * @param child\n     */\n    protected scrollParentToChild(parent: HTMLElement, child: HTMLElement): void {\n        const { viewableDetectionEpsilon } = this.props;\n        if (!ScrollableFeed.isViewable(parent, child, viewableDetectionEpsilon!)) {\n            //Source: https://stackoverflow.com/a/45411081/6316091\n            const parentRect = parent.getBoundingClientRect();\n            const childRect = child.getBoundingClientRect();\n\n            //Scroll by offset relative to parent\n            const scrollOffset = (childRect.top + parent.scrollTop) - parentRect.top;\n            const { animateScroll, onScrollComplete } = this.props;\n            if (animateScroll) {\n                animateScroll(parent, scrollOffset);\n                onScrollComplete!();\n            }\n        }\n    }\n\n    /**\n     * Returns whether a child element is visible within a parent element\n     *\n     * @param parent\n     * @param child\n     * @param epsilon\n     */\n    private static isViewable(parent: HTMLElement, child: HTMLElement, epsilon: number): boolean {\n        epsilon = epsilon || 0;\n\n        //Source: https://stackoverflow.com/a/45411081/6316091\n        const parentRect = parent.getBoundingClientRect();\n        const childRect = child.getBoundingClientRect();\n\n        const childTopIsViewable = (childRect.top >= parentRect.top);\n\n        const childOffsetToParentBottom = parentRect.top + parent.clientHeight - childRect.top;\n        const childBottomIsViewable = childOffsetToParentBottom + epsilon >= 0;\n\n        return childTopIsViewable && childBottomIsViewable;\n    }\n\n    /**\n     * Fires the onScroll event, sending isAtBottom boolean as its first parameter\n     */\n    protected handleScroll(): void {\n        const { viewableDetectionEpsilon, onScroll } = this.props;\n        if (onScroll && this.bottomRef.current && this.wrapperRef.current) {\n            const isAtBottom = ScrollableFeed.isViewable(this.wrapperRef.current, this.bottomRef.current, viewableDetectionEpsilon!);\n            onScroll(isAtBottom);\n        }\n    }\n\n    /**\n     * Scroll to the bottom\n     */\n    public scrollToBottom(): void {\n        if (this.bottomRef.current && this.wrapperRef.current) {\n            this.scrollParentToChild(this.wrapperRef.current, this.bottomRef.current);\n        }\n    }\n\n    render(): React.ReactNode {\n      console.log(\"Component \", this.render.name);\n\n        const style: CSSProperties = {\n            maxHeight: \"inherit\",\n            height: \"inherit\",\n            overflowY: \"auto\",\n        };\n        const { children, className } = this.props;\n        return (\n            <div className={className} style={style} ref={this.wrapperRef} onScroll={this.handleScroll}>\n                {children}\n                <div ref={this.bottomRef}></div>\n            </div>\n        );\n    }\n}\n\nexport default ScrollableFeed;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}